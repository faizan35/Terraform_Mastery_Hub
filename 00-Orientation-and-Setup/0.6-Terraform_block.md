# 0.6 — Terraform block

## Terraform Block Essentials

### 1. `required_version`

- Specifies Terraform CLI version constraints to ensure compatibility.
- Example usage:

  ```hcl
  terraform {
    required_version = "~> 1.5.0"  # Accepts 1.5.x, but not 1.6
  }
  ```

- **Best practice:** Set a minimum to support needed features, and a maximum to avoid untested breaking changes.

### 2. `required_providers`

- Declares which providers your configuration requires, including their source and version constraints.
- Example:

  ```hcl
  terraform {
    required_providers {
      aws = {
        source  = "hashicorp/aws"
        version = "~> 5.0"
      }
      kubernetes = {
        source  = "hashicorp/kubernetes"
        version = "~> 2.6.1"
      }
    }
  }
  ```

- This ensures Terraform installs the right provider packages.

### 3. Provider Installation: Caching, Mirrors, Air-Gapped Setup

#### a. Plugin Caching & Filesystem Mirrors

- Terraform supports using a local cache (`.terraform.d/plugins/...`) instead of downloading providers every time.
- Especially useful in CI or offline environments.

#### b. Network Mirrors

- Terraform can be configured via the CLI config (`.terraformrc` or `terraform.rc`) to use a network mirror:

  ```hcl
  provider_installation {
    network_mirror {
      url = "https://terraform.example.com/providers/"
    }
  }
  ```

- The mirror protocol mirrors providers regardless of their original hostname, giving flexibility in air-gapped or internal environments.

#### c. `terraform providers mirror` Command

- Terraform’s `terraform providers mirror` can pre-download required provider binaries into a local directory for offline use.
- Perfect for prepping air-gapped environments.

#### d. Air-Gapped Terraform Enterprise Setup

- In fully isolated environments, Terraform Enterprise supports bundles of pre-downloaded Terraform binaries and providers, which are manually staged into the environment.
- When using a private registry, you can download public provider packages (plus checksums) and upload them to your internal registry for controlled use.

## Interview Cheat Sheet

| Feature                      | Purpose                               | Key Note                                  |
| ---------------------------- | ------------------------------------- | ----------------------------------------- |
| `required_version`           | Lock Terraform CLI compatibility      | Use range (`~>`) to control updates       |
| `required_providers`         | Declare providers, sources, versions  | Ensures proper plugin management          |
| Filesystem Cache             | Reuse provider files locally          | Speeds up init, great for CI              |
| Network Mirror               | Internal proxy for provider downloads | Supports air-gap, internal cache use      |
| `terraform providers mirror` | Download providers ahead of time      | Works offline or in mirrored environments |
| Air-Gapped Setup             | Bundle Terraform + providers manually | Used in isolated, secure deployments      |

**Pro Tip (for interviews):**
_"In air-gapped environments, we use `terraform providers mirror` to stage binaries offline or configure `.terraformrc` with network mirrors. In Terraform Enterprise, we deploy provider bundles or host them in a private registry for internal, controlled use."_

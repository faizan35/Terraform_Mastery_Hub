# 0.8 — CLI config & provider mirrors

## 1. CLI Config File (`.terraformrc` / `terraform.rc`)

- **Location (by OS):**

  - **Linux/macOS:** `~/.terraformrc` in the user's home directory.
  - **Windows:** `terraform.rc` in `%APPDATA%` (e.g., `C:\Users\<User>\AppData\Roaming\terraform.rc`).
  - You can override the default path using `TF_CLI_CONFIG_FILE` environment variable with a `.tfrc` file.

## 2. `provider_installation` Block (within CLI config)

This block allows you to customize how Terraform installs provider plugins:

- **Filesystem Mirror**
  Reuse pre-downloaded providers from a local directory—ideal for offline environments or CI caching:

  ```hcl
  provider_installation {
    filesystem_mirror {
      path = "/usr/local/lib/terraform"  # local directory with provider binaries
    }
    direct {
      exclude = ["registry.terraform.io/*/*"]
    }
  }
  ```

  This ensures Terraform looks in that directory only, avoiding external registries.

- **Network Mirror**
  Download providers from an internal HTTP mirror—useful in air-gapped corporate setups:

  ```hcl
  provider_installation {
    network_mirror {
      url = "https://terraform.example.com/providers/"
    }
  }
  ```

  All provider downloads will route through this mirror regardless of original hostname.

- **Dev Overrides**
  Use custom-built or modified provider binaries during development:

  ```hcl
  provider_installation {
    dev_overrides {
      "registry.terraform.io/hashicorp/example" = "/home/user/custom-providers/terraform-provider-example"
    }
    direct {}
  }
  ```

  Terraform prefers the overridden binary for that provider source.

## 3. `terraform providers mirror` Command

Terraform includes a command to pre-populate local mirrors with required providers:

```bash
terraform providers mirror <target-directory>
```

This creates the proper directory structure and downloads `.zip` provider binaries and JSON index files, ready for offline use—especially handy when preparing isolated or CI environments.

## 4. Real-World Example (Air-Gapped Setup)

**Steps:**

1. Run `terraform providers mirror` on an internet-connected system:

   ```bash
   terraform providers mirror /path/to/terraform_mirror
   ```

2. Copy that directory to your isolated environment.
3. Create a CLI config file (`.terraformrc`) like:

   ```hcl
   provider_installation {
     filesystem_mirror {
       path = "/path/to/terraform_mirror"
       include = ["registry.terraform.io/*/*"]
     }
     direct {
       exclude = ["registry.terraform.io/*/*"]
     }
   }
   ```

4. Optionally export:

   ```bash
   export TF_PLUGIN_CACHE_DIR="/path/to/terraform_mirror"
   export TF_CLI_CONFIG_FILE="/path/to/terraform_mirror/.terraformrc"
   ```

5. Run Terraform as usual. It will install providers from the local mirror only, without accessing the internet.

## 5. Summary Table

| Topic                            | Description                                                                                         |
| -------------------------------- | --------------------------------------------------------------------------------------------------- |
| **Config File Location**         | `~/.terraformrc` (Unix), `%APPDATA%\\terraform.rc` (Windows), overrideable via `TF_CLI_CONFIG_FILE` |
| **Filesystem Mirror**            | Use local directories to store provider binaries for offline or cached installs                     |
| **Network Mirror**               | Redirect provider downloads to internal HTTP mirrors                                                |
| **Dev Overrides**                | Override provider sources during development/test builds                                            |
| **`terraform providers mirror`** | Populates a local mirror with providers and index files for offline use or distribution             |

### Interview-Ready Summary:

> “Terraform’s CLI config lives in `~/.terraformrc` on Linux/macOS or `%APPDATA%\\terraform.rc` on Windows (overrideable via `TF_CLI_CONFIG_FILE`). The `provider_installation` block lets you define where Terraform fetches provider plugins—from a local filesystem mirror, a network mirror, or development overrides. The `terraform providers mirror` command helps seed a directory for offline distribution. This setup is essential for controlled, air-gapped, or CI/CD environments.”

# 0.4 - Environment Patterns in Terraform

### 1. Environment Folders (`dev/`, `staging/`, `prod/`)

- **Structure:**

  ```sh
  project/
  ├── dev/
  │   └── main.tf
  ├── staging/
  │   └── main.tf
  └── prod/
      └── main.tf
  ```

- Each folder has its own set of configs or variable files.
- Sometimes they share the same modules, but pass different inputs (like instance size, region, tags).

**Why use them?**

- To keep **environments isolated** (so dev changes don’t accidentally touch prod).
- Each folder can point to a **different backend** (state file location).

**How to use them?**

- Navigate into the folder, run Terraform as usual:

  ```bash
  cd dev && terraform init && terraform apply
  ```

- Keeps state, variables, and outputs neatly separated.

---

### 2. Workspaces

- Workspaces allow **multiple states** from the **same configuration directory**.
- Default workspace = `default`.
- Example:

  ```bash
  terraform workspace new dev
  terraform workspace select dev
  terraform apply
  ```

- Terraform will create separate state files:

  ```
  terraform.tfstate.d/dev/terraform.tfstate
  terraform.tfstate.d/prod/terraform.tfstate
  ```

**When to use them?**

- Good for simple setups with identical infra across environments.
- Less visible than separate folders, so can be riskier if not documented.
- Many teams prefer **folders + remote backends** for clarity.

### 3. Important Things to Keep in Mind

- **State isolation**: Each environment must have its own state (whether by folder, workspace, or backend config).
- **Naming conventions**: Use consistent env names (`dev`, `staging`, `prod`).
- **Backend separation**: Point dev/staging/prod to different state storage (e.g., separate S3 buckets or key prefixes).
- **Variables per environment**: Use `dev.tfvars`, `staging.tfvars`, `prod.tfvars` or environment-specific overrides.
- **Secrets**: Never hardcode env secrets; inject via `TF_VAR_` or secret managers.
- **CI/CD usage**: Pipelines usually select the correct folder/workspace automatically based on branch (e.g., `main` → `prod`, `develop` → `dev`).

### Interview Shortcut

- **Folders** → Clear separation, good visibility.
- **Workspaces** → Same code, multiple states, but less explicit.
- **Golden rule** → Always isolate state per environment to avoid “dev apply” messing with prod.

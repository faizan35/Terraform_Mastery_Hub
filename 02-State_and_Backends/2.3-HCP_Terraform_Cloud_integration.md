# 2.3 ‚Äî HCP Terraform (Cloud) Integration

## 1. `cloud` Block

### **What it is**

- A configuration inside the `terraform {}` block that tells Terraform to use **HCP Terraform (Terraform Cloud)** for state storage and (optionally) remote operations.

### **Basic Example**

```hcl
terraform {
  cloud {
    organization = "faizan-org"

    workspaces {
      name = "prod-network"
    }
  }
}
```

- **organization** ‚Üí Your Terraform Cloud org.
- **workspaces** ‚Üí Binding to a specific workspace (or dynamic selection, e.g. based on branch).

### **Workspace Binding Options**

1. **Single Workspace (fixed):**

   ```hcl
   workspaces {
     name = "prod-network"
   }
   ```

   ‚Üí Always runs in `prod-network` workspace.

2. **Multiple Workspaces (prefix):**

   ```hcl
   workspaces {
     prefix = "network-"
   }
   ```

   ‚Üí If you run `terraform workspace select dev`, it binds to `network-dev`.

### **Authentication**

- First, login with:

  ```bash
  terraform login
  ```

  ‚Üí Stores API token in `~/.terraform.d/credentials.tfrc.json`.

- After this, Terraform can talk to HCP Terraform automatically.

### **Effect of `cloud` block**

- Tells Terraform:

  - ‚ÄúStore my state remotely in Terraform Cloud.‚Äù
  - ‚ÄúLink runs to this org/workspace.‚Äù

- You can then configure whether **executes remotely** (Terraform Cloud agents) or **locally** (still remote state, but plan/apply on your machine/CI).

## 2. Remote Ops vs Local Ops

- **Remote Ops (default with cloud block):**

  - Terraform plan & apply are executed **inside Terraform Cloud** (not your laptop).
  - Pros: central logging, shared state, RBAC, drift detection.
  - Cons: requires network access to HCP, less control if you want custom local tooling.

- **Local Ops:**

  - You still use HCP Terraform as backend (state stored in cloud),
  - but actual plan/apply runs locally on your machine or in CI/CD.
  - Switchable in settings.

## 3. Saved Plans & Approvals

- **Plan Phase:**

  - Terraform Cloud always stores the generated plan.
  - Other team members can review it.

- **Apply Phase:**

  - Can require **manual approval** before apply (common in prod).
  - Enables **policy enforcement** (Sentinel/OPA) before changes go live.

## 4. Org / Project / Workspace Concepts

- **Organization:**

  - Top-level entity in Terraform Cloud (your company/team).

- **Projects (newer feature in HCP):**

  - Group related workspaces (e.g., ‚ÄúNetworking‚Äù, ‚ÄúEKS clusters‚Äù, ‚ÄúDatabases‚Äù).
  - Helps organize large environments.

- **Workspace:**

  - Execution context for a given state.
  - Each workspace = **one state file**.
  - Common patterns:

    - One workspace per environment (`dev`, `stage`, `prod`).
    - Or one workspace per component (`network`, `app`, `db`).

üëâ Shortcut: _‚ÄúOrg is the company, projects are folders, workspaces are states.‚Äù_
